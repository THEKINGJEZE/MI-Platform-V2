# Claude Code Setup Audit â€” 23 January 2026 (Updated)

## Executive Summary

Setup is healthy (8.5/10). All configurations are valid with no critical issues or security vulnerabilities. Recent enhancement: `/audit-claude-setup` subagents upgraded to Opus 4.5 with validation layer. Top recommendations: consolidate MCP permissions using wildcards, reduce CLAUDE.md size from 196 to ~80 lines, and add `once: true` to SessionStart hook.

## Setup Health Check

### Overall Status: âœ… Healthy

**Health Score**: 8.5/10

### Critical Issues (Must Fix Before Anything Else)

âœ… No critical issues found

### Warnings (Should Address)

| Warning | Location | Concern | Recommendation |
|---------|----------|---------|----------------|
| CLAUDE.md size | `CLAUDE.md` | 196 lines exceeds 80-line target | Extract tables to reference docs |
| Permission accumulation | `.claude/settings.local.json` | 133 lines of ad-hoc permissions | Consolidate using wildcards |
| Model string inconsistency | `.claude/agents/*.md` | Mix of `opus` and full IDs | Standardize on one convention |

### Validation Summary

| Category | Passed | Failed | Warnings |
|----------|--------|--------|----------|
| CLAUDE.md | 3 | 0 | 1 |
| Settings | 4 | 0 | 1 |
| Hooks | 6 | 0 | 0 |
| Skills | 2 | 0 | 0 |
| Agents | 6 | 0 | 1 |
| Commands | 2 | 0 | 0 |
| Security | 5 | 0 | 0 |
| Consistency | 7 | 0 | 0 |
| **Total** | **35** | **0** | **3** |

---

---

## Current Configuration

### CLAUDE.md
- **Location**: `/Users/jamesjeram/Documents/MI-Platform-V2/CLAUDE.md`
- **Lines**: 197
- **Key sections**: Mission Lock, Current Focus, Tech Stack, Guardrails, Mandatory Agent Usage, Load On-Demand, Project Skills, Session Protocol, Git Commit Protocol, Context Hygiene, Completion Rules, Weekly Maintenance, Quick Commands

### Settings
- **Default model**: sonnet
- **Permissions**: Restrictive in settings.json (blocks rm -rf, sudo, ANCHOR.md edits); permissive in settings.local.json (full MCP access)
- **Context auto-load**: ANCHOR.md, CLAUDE.md, STATUS.md

### Hooks
| Hook | Trigger | Purpose |
|------|---------|---------|
| session-start.sh | SessionStart | Context injection, document health check, Monday maintenance reminder |
| pre-edit-check.sh | PreToolUse (Edit\|Write) | Consistency warnings before document edits |
| pre-compact.sh | PreCompact | Force STATUS.md freshness check before context compression |
| post-status-edit.sh | PostToolUse (STATUS.md) | Auto-sync phase from STATUS.md to CLAUDE.md |
| Stop | Stop | Completion checklist before ending session (prompt-based) |

### Agents
| Agent | Model | Tools | Purpose |
|-------|-------|-------|---------|
| workflow-builder | sonnet | Read, Write, Edit, Grep, Glob, Bash | n8n workflow design with logging, error handling standards |
| signal-triage | sonnet | Read, Grep, Glob, Bash | UK police signal classification, domain expertise |
| alignment-checker | haiku | Read, Grep, Glob | Read-only audit against ANCHOR.md mission criteria |
| docs-fetcher | **opus** | WebFetch, WebSearch | Claude Code documentation analysis |
| config-auditor | **opus** | Read, Glob, Grep | Configuration inventory and audit |
| improvement-planner | **opus** | Read | Generate prioritized recommendations |
| audit-reference-integrity | haiku | Read, Grep, Glob | Validate @references, markdown links |
| audit-single-source-truth | haiku | Read, Grep, Glob | Detect duplicated information |
| audit-roadmap-alignment | sonnet | Read, Grep, Glob | Verify STATUS/specs match ROADMAP |
| audit-schema-alignment | haiku | Read, Grep, Glob | Check schema references match SPEC-001 |
| audit-guardrail-compliance | haiku | Read, Grep, Glob | Verify guardrail references (G-XXX) are valid |

### Commands
| Command | Description |
|---------|-------------|
| /health-check | Verify all API connections (Airtable, n8n, HubSpot, Claude API) |
| /check-alignment | Query alignment-checker agent for drift detection |
| /deploy-workflow | Import n8n workflow to live instance |
| /hygiene-check | Check document sizes against limits |
| /consistency-check | Validate cross-document references |
| /implement | Stage-gated spec implementation with progress tracking |
| /prep-spec | Generate spec context brief |
| /doc-audit | Comprehensive documentation alignment audit |
| /audit-claude-setup | Audit Claude Code configuration (this command) |

### Skills
| Skill | Path | Status |
|-------|------|--------|
| uk-police-design-system | skills/uk-police-design-system/ | Active |
| adhd-interface-design | skills/adhd-interface-design/ | Ready for Phase 1c |
| action-oriented-ux | skills/action-oriented-ux/ | Ready for Phase 1c |
| uk-police-market-domain | skills/uk-police-market-domain/ | Active |
| technical-architecture | skills/technical-architecture/ | Active |
| competitive-analysis | skills/competitive-analysis/ | Ready for Phase 1b |
| b2b-visualisation | skills/b2b-visualisation/ | Deferred |
| notification-system | skills/notification-system/ | Deferred |
| board-dashboard-design | skills/board-dashboard-design/ | Deferred |
| intelligence-source-grading | skills/intelligence-source-grading/ | Deferred |
| lead-scoring-methodology | skills/lead-scoring-methodology/ | Deferred |
| hubspot-integration | skills/hubspot-integration/ | Deferred |
| uk-public-sector-procurement | skills/uk-public-sector-procurement/ | Deferred |

### Rules
| Rule | Path | Purpose |
|------|------|---------|
| n8n | .claude/rules/n8n.md | n8n workflow standards (logging, naming, error handling) |
| airtable | .claude/rules/airtable.md | Airtable API patterns (rate limits, batch ops, filtering) |
| skills-usage | .claude/rules/skills-usage.md | Skills governance (active vs deferred, schema prerequisites) |

---

## Documentation Updates

### New Features Available (from Claude Code 2.1.x documentation)
- **MCP Tool Search (Lazy Loading)**: Reduces token usage from ~134k to ~5k for projects with many MCP tools
- **Skill Hot-Reload**: Skills in `.claude/skills` immediately available without restart
- **Hook `once: true`**: Run hooks only once per session (useful for SessionStart)
- **Wildcard MCP Permissions**: `mcp__server__*` syntax for bulk permissions
- **LSP Tool**: Code intelligence (go-to-definition, find references)
- **Sandbox Mode**: Filesystem/network sandboxing for safer testing
- **Path-Specific Rules**: Rules that only load for matching file patterns
- **`/compact <instructions>`**: Focused context compaction

### Changed Patterns
- **NPM Installation Deprecated**: Use `claude install` or native installers
- **OAuth URL Changed**: Now platform.claude.com instead of console.anthropic.com
- **Context Window Fix**: v2.1.14 fixed blocking at ~65% instead of ~98%

### Deprecations/Warnings
- **SSE Transport for MCP**: Deprecated; use HTTP transport where available
- **WebDAV on Windows**: Security risk; could bypass permission system
- **Over-specified CLAUDE.md**: Documentation emphasizes keeping CLAUDE.md lean (current: 196 lines, target: 80)
- **Kitchen sink sessions**: Anti-pattern of multiple unrelated tasks in one session

---

## Recommendations

### ðŸ”´ Critical Issues (Fix These First)

âœ… No critical issues â€” proceed to high priority recommendations

### ðŸŸ  High Priority

#### 1. Consolidate MCP Permissions Using Wildcards
- **Gap**: `settings.local.json` has ~76 individual MCP tool permissions
- **Recommendation**: Use wildcard syntax (e.g., `mcp__airtable__*` instead of 12 individual permissions)
- **Docs reference**: Claude Code settings - wildcard MCP permissions
- **Effort**: Low (15 minutes)
- **Benefit**: Reduces permission list from ~76 lines to ~15 lines, easier to audit

#### 2. Reduce CLAUDE.md Size
- **Gap**: 196 lines vs 80-line target (per your own DOCUMENT-HYGIENE.md)
- **Recommendation**: Extract detailed tables to reference docs, keep CLAUDE.md as lean index
- **Effort**: Medium (30-45 minutes)
- **Benefit**: Faster context loading, follows documented best practice
- **Sections to extract**: Load On-Demand table, Mandatory Agent Usage table, Weekly Maintenance details

#### 3. Add `once: true` to SessionStart Hook
- **Gap**: SessionStart runs every time, but context injection only needs to happen once
- **Recommendation**: Add `"once": true` to prevent redundant runs on `/rewind`
- **Effort**: Low (2 minutes)
- **Benefit**: Cleaner session behavior, no duplicate context injections

#### 4. Remove Duplicate Playwright Permissions
- **Gap**: Both `mcp__playwright__*` and `mcp__plugin_playwright_playwright__*` permissions exist
- **Recommendation**: Audit which server is in use, remove duplicate set
- **Effort**: Low (10 minutes)
- **Benefit**: Cleaner permissions, reduced confusion

### ðŸŸ¡ Medium Priority

#### 5. Create `.mcp.json` for Project-Specific MCP Configuration
- **Gap**: No `.mcp.json`; MCP config in global settings
- **Recommendation**: Create project-specific config for portability
- **Effort**: Medium (20 minutes)
- **Benefit**: Version-controlled MCP setup, easier onboarding

#### 6. Add Notification Hook for Long-Running Operations
- **Gap**: No notification when significant operations complete
- **Recommendation**: Add macOS notification hook:
  ```json
  "Notification": [{
    "matcher": "*",
    "hooks": [{
      "type": "command",
      "command": "osascript -e 'display notification \"Task complete\" with title \"Claude Code\"'"
    }]
  }]
  ```
- **Effort**: Low (10 minutes)
- **Benefit**: Can step away during batch processing, get notified when ready

#### 7. Add Sandbox Mode for Workflow Testing
- **Gap**: No sandbox/dry-run mode for testing n8n workflows safely
- **Recommendation**: Create testing environment flag
- **Effort**: Medium (30 minutes)
- **Benefit**: Safer testing, prevents accidental production changes

#### 8. Standardize Agent Model Strings
- **Gap**: Mix of full IDs (`claude-opus-4-5-20251101`) and short names (`sonnet`)
- **Recommendation**: Standardize on one convention (short names recommended for easier upgrades)
- **Effort**: Low (5 minutes)
- **Benefit**: Consistent configuration style

### ðŸŸ¢ Low Priority / Future

#### 9. Add LSP Tool for Code Intelligence
- **Gap**: No LSP configuration for TypeScript/React
- **Recommendation**: Enable LSP when dashboard TypeScript work resumes
- **Effort**: Low (10 minutes)

#### 10. Implement Writer/Reviewer Pattern for Specs
- **Gap**: No separation between writing and reviewing specs
- **Recommendation**: Create `spec-reviewer` agent with read-only tools
- **Effort**: Medium (30 minutes)

#### 11. Add `/compact <focus>` Usage Guidance
- **Gap**: Focused compaction not documented in CLAUDE.md
- **Recommendation**: Add example to Session Protocol
- **Effort**: Low (5 minutes)

### Not Recommended for This Project

| Feature | Why Not |
|---------|---------|
| MCP Tool Search / Lazy Loading | Fixed set of MCP tools; explicit allowlist is clearer |
| `context: fork` for Skills | Skills are reference material, not isolated contexts |
| Aggressive session isolation | Monday workflow benefits from accumulated context |

---

## Quick Wins

Changes that take <5 minutes:

1. **Add `once: true` to SessionStart hook** (2 min) â€” Edit `settings.json` line 42
2. **Remove duplicate Playwright permissions** (5 min) â€” Edit `settings.local.json`
3. **Add macOS notification hook** (5 min) â€” Add Notification section to `settings.json`

**Total: ~12 minutes for immediate friction reduction**

---

## Issues Found

| Severity | Issue | Location | Fix |
|----------|-------|----------|-----|
| âš ï¸ Warning | CLAUDE.md exceeds size limit | `CLAUDE.md` | Extract tables to reference docs |
| âš ï¸ Warning | Permission accumulation | `.claude/settings.local.json` | Consolidate with wildcards |
| âš ï¸ Warning | Inconsistent model strings | `.claude/agents/*.md` | Standardize convention |

## Security Summary

| Check | Status |
|-------|--------|
| No hardcoded secrets | âœ… OK |
| ANCHOR.md write-protected | âœ… OK |
| Destructive commands blocked | âœ… OK |
| WebFetch domain-restricted | âœ… OK |
| No bypass/sandbox disable flags | âœ… OK |
| MCP permissions explicit | âœ… OK |

---

## Configuration Quality Score

| Dimension | Score | Notes |
|-----------|-------|-------|
| Clarity | 9/10 | Mission clear, file purposes evident, good documentation |
| Completeness | 8/10 | All key areas covered; CLAUDE.md slightly oversized |
| Enforcement | 9/10 | 5 hooks provide excellent lifecycle management |
| Security | 9/10 | Restrictive defaults; ANCHOR.md protected |
| Maintainability | 8/10 | Good separation of concerns; permissions need cleanup |
| **Overall** | **8.5/10** | Strong, professional configuration with minor optimizations available |

---

## Next Audit

Recommended: **23 February 2026** (1 month)

Or sooner if:
- Major Claude Code documentation updates announced
- New MCP servers added to project
- Phase transition (1d â†’ 1e)

---

*Generated by `/audit-claude-setup` command*
*Runtime: ~3 minutes (3 subagents: docs-fetcher, config-auditor, improvement-planner)*
*Subagent models: Opus 4.5 (upgraded 23 Jan 2026)*
